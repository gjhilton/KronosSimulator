#include <FastSPI_LED.h>

#define PIN 4

// Image data generated by KronosSimulator.app
// file: step3.png
// generated at 2012-10-31-14-12-52-567


#define N_FRAMES 32
#define N_PIXELS 32

const int frames[N_FRAMES][N_PIXELS] = {{16711680,16711680,16711680,16711680,16711680,16711680,16711680,16711691,16711725,16711764,16711804,16711845,16711882,16711913,16711935,16711935,16711935,14811391,12452095,10027263,7471359,4980991,2687231,655615,255,3583,11775,20991,30463,39935,48895,56831},{16711680,16711680,16711680,16711680,16711680,16711680,16711691,16711726,16711765,16711806,16711846,16711883,16711914,16711935,16711935,16711935,14680319,12452095,9961727,7340287,4849919,2621695,590079,511,4095,11775,21247,30975,40191,49151,57087,62975},{16711680,16711680,16711680,16711680,16711680,16711693,16711728,16711766,16711807,16711848,16711884,16711915,16711935,16711935,16646399,14614783,12321023,9830655,7274751,4784383,2425087,524543,511,4351,12543,21503,31231,40703,49407,57343,63487,65527},{16711680,16711680,16711680,16711680,16711694,16711729,16711768,16711809,16711849,16711886,16711917,16711935,16711935,16646399,14549247,12124415,9765119,7209215,4718847,2425087,524543,511,4607,12799,21759,31487,40959,49919,57599,63487,65527,65506},{16711680,16711680,16711680,16711695,16711730,16711769,16711811,16711851,16711887,16711918,16711935,16711935,16515327,14483711,12058879,9634047,7143679,4653311,2359551,459007,511,4607,13055,22271,31999,41215,50175,57855,63743,65527,65506,65479},{16711680,16711681,16711696,16711731,16711771,16711812,16711852,16711889,16711918,16711935,16711935,16449791,14352639,12058879,9568511,7078143,4522239,2162943,459007,767,4863,13311,22527,32255,41983,50687,58111,63999,65526,65504,65476,65446},{16711681,16711697,16711732,16711772,16711815,16711854,16711890,16711920,16711935,16711935,16318719,14287103,11927807,9371903,6947071,4456703,2162943,459007,767,5119,13567,23295,32767,42495,50943,58367,63999,65526,65503,65476,65443,65408},{16711699,16711734,16711775,16711816,16711855,16711890,16711920,16711935,16711935,16253183,14221567,11927807,9371903,6815999,4391167,2162943,393471,767,5375,14079,23295,33023,42751,51199,58623,63999,65525,65502,65475,65442,65406,65367},{16711735,16711776,16711817,16711857,16711892,16711921,16711935,16711935,16253183,14090495,11796735,9240831,6750463,4194559,2031871,393471,767,5887,14335,23807,33535,43007,51455,59135,64255,65524,65501,65473,65441,65404,65365,65314},{16711778,16711819,16711858,16711893,16711922,16711935,16711935,16122111,14024959,11600127,9109759,6553855,4129023,2031871,393471,767,6143,14591,24319,33791,43519,51967,59391,64511,65523,65500,65472,65440,65404,65362,65311,65280},{16711820,16711860,16711894,16711923,16711935,16711935,16056575,13959423,11600127,9109759,6553855,4129023,1835263,327935,1023,6655,14847,24575,34303,43775,51967,59647,64511,65523,65499,65471,65439,65402,65361,65306,65280,65280},{16711861,16711896,16711925,16711935,16711935,16056575,13828351,11469055,8913151,6422783,4063487,1835263,262399,1023,6655,15615,24831,34559,44031,52479,59903,64767,65522,65498,65470,65438,65401,65361,65303,65280,65280,65280},{16711897,16711926,16711935,16711935,15991039,13762815,11403519,8847615,6357247,3997951,1638655,262399,1279,7167,15871,25087,34815,44543,52479,59903,65023,65520,65497,65469,65436,65399,65358,65300,65280,65280,65280,65280},{16711926,16711935,16711935,15859967,13697279,11272447,8716543,6226175,3866879,1638655,262399,1279,7167,16127,25599,35071,44799,53247,60415,65279,65520,65496,65468,65435,65398,65356,65296,65280,65280,65280,65280,65280},{16711935,16711935,15859967,13566207,11141375,8651007,6160639,3735807,1573119,196863,1535,7423,16639,25855,35583,45055,53503,60415,65279,65519,65496,65466,65432,65396,65355,65292,65280,65280,65280,65280,65280,65280},{16711935,15663359,13500671,11075839,8651007,6095103,3604735,1376511,196863,1535,8191,16895,26111,36095,45311,53503,60927,65535,65518,65494,65466,65431,65394,65352,65286,65280,65280,65280,65280,65280,65280,65280},{15597823,13435135,11010303,8454399,5898495,3539199,1376511,196863,1535,8191,17151,26879,36351,45823,54015,60927,65534,65518,65493,65464,65430,65392,65351,65281,65280,65280,65280,65280,65280,65280,65280,3931904},{13304063,10944767,8388863,5832959,3473663,1310975,131327,1535,8703,17407,27135,36607,46079,54271,61183,65535,65517,65492,65463,65429,65391,65349,65280,65280,65280,65280,65280,65280,65280,65280,4456192,9830144},{10879231,8323327,5767423,3408127,1310975,131327,1791,8959,17919,27391,36863,46591,54527,61439,65534,65516,65492,65462,65428,65391,65346,65280,65280,65280,65280,65280,65280,65280,65280,4718336,9961216,13238016},{8126719,5701887,3277055,1245439,131327,1791,9215,18175,27647,37375,46591,54783,61439,65533,65515,65490,65461,65426,65389,65345,65280,65280,65280,65280,65280,65280,65280,65280,5177088,10092288,13303552,15597312},{5636351,3211519,1114367,131327,2047,9471,18943,28159,37887,47103,55295,61439,65533,65514,65489,65460,65425,65388,65343,65280,65280,65280,65280,65280,65280,65280,65280,5373696,10288896,13434624,15597312,16775936},{3145983,1048831,65791,2303,9983,18943,28415,38143,47359,55295,61695,65532,65513,65488,65457,65424,65386,65342,65280,65280,65280,65280,65280,65280,65280,65280,5570304,10419968,13500160,15793920,16775680,16770304},{983295,255,2559,10495,19199,28927,38655,47615,55551,61951,65532,65513,65487,65456,65422,65384,65340,65280,65280,65280,65280,65280,65280,65280,65280,5832448,10551040,13631232,15793920,16775680,16770048,16762368},{255,2815,10751,19711,29439,38655,47871,55807,62207,65531,65512,65486,65456,65421,65383,65339,65280,65280,65280,65280,65280,65280,65280,65280,6160128,10682112,13696768,15859456,16775424,16769792,16762112,16753408},{3071,11007,19967,29951,39423,48383,56319,62463,65530,65511,65485,65454,65419,65380,65337,65280,65280,65280,65280,65280,65280,65280,65280,6356736,10747648,13827840,15859456,16775168,16769536,16761856,16753152,16743936},{11263,20223,30207,39679,48639,56575,62463,65529,65510,65485,65452,65418,65379,65334,65280,65280,65280,65280,65280,65280,65280,65280,6684416,11009792,13893376,15990528,16775168,16769280,16761600,16752640,16743424,16733696},{20735,30463,39935,48895,56831,62719,65529,65510,65483,65451,65417,65376,65332,65280,65280,65280,65280,65280,65280,65280,65280,6881024,11140864,13893376,15990528,16774656,16769024,16761344,16752384,16743168,16733184,16723968},{30719,40191,49151,57087,62975,65528,65508,65482,65450,65415,65376,65330,65280,65280,65280,65280,65280,65280,65280,65280,7077632,11206400,14089984,16121600,16774656,16768768,16760832,16752128,16742656,16732928,16723456,16715264},{40703,49407,57343,63231,65528,65508,65481,65449,65413,65374,65328,65280,65280,65280,65280,65280,65280,65280,65280,7339776,11337472,14221056,16121600,16774400,16768512,16760576,16751616,16742144,16732416,16723200,16715008,16711680},{49919,57855,63487,65527,65507,65480,65448,65412,65373,65324,65280,65280,65280,65280,65280,65280,65280,65280,7339776,11468544,14221056,16252672,16774144,16768256,16760320,16751360,16741888,16732160,16723200,16715008,16711680,16711680},{58111,63487,65527,65504,65479,65446,65411,65371,65323,65280,65280,65280,65280,65280,65280,65280,65280,7536384,11534080,14286592,16252672,16774144,16768000,16760064,16751104,16741632,16731648,16722688,16714496,16711680,16711680,16711680},{63999,65526,65504,65478,65444,65410,65370,65323,65280,65280,65280,65280,65280,65280,65280,65280,7667456,11796224,14483200,16318208,16773888,16767744,16759808,16750592,16741376,16731392,16722432,16714496,16711680,16711680,16711680,16711680}}; 



struct CRGB { unsigned char r; unsigned char g; unsigned char b; };
struct CRGB *leds;

void setup() {
  FastSPI_LED.setLeds(N_PIXELS);
  FastSPI_LED.setChipset(CFastSPI_LED::SPI_WS2801);
  FastSPI_LED.setDataRate(3);
  FastSPI_LED.setPin(PIN);  
  FastSPI_LED.init();
  FastSPI_LED.start();

  leds = (struct CRGB*)FastSPI_LED.getRGBData(); 
}

void loop() {
  memset(leds, 0, N_PIXELS * 3);
  for(int frame=0; frame<N_FRAMES; frame++){
    for(int pixel=0; pixel<N_PIXELS; pixel++){
      int colour = frames[frame][pixel];
      int r = (colour >> 16) & 0xff;
      int g = (colour >> 8) & 0xff;
      int b = (colour >> 0) & 0xff;
      leds[pixel].r = r;
      leds[pixel].g = g;
      leds[pixel].b = b;
    }
    FastSPI_LED.show();
    delay(10);
  }  
}


/*

// example image data format

#define N_FRAMES 2
#define N_PIXELS 4

const int frames[N_FRAMES][N_PIXELS] = {{1,2,3,4},{5,6,7,8}};

*/

/*
int toHex(int r, int g, int b){
	return
	((0xff & (unsigned char) r) << 16) |
	((0xff & (unsigned char) g) << 8) |
	((0xff & (unsigned char) b));
}
*/
